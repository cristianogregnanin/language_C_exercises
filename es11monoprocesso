#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <unistd.h>

int main(int argc, char *argv[]) {
    if (argc < 2) {
        printf("Numero argomenti sabgliato");
        return -1;
    }

    char input[256];
    char argomento_grep[512];
    char articolo_iniziale[16];
    char articolo_finale[16];

    while (1) {
        printf("Inserisci l'articolo da cercare (inserisci 'esci' per uscire): ");
        fgets(input, 256, stdin);
        input[strcspn(input, "\n")] = '\0';

        if (strcmp(input, "esci") == 0) {
            break;
        }

        sprintf(articolo_iniziale, "ART. %s. ", input);
        sprintf(articolo_finale, "ART. %d. ", atoi(input) + 1);

        sprintf(argomento_grep, "-P '(?<= %s)(?s).*(?= %s)'", articolo_iniziale, articolo_finale);

        execl("/usr/bin/grep", "-z", "-o", argomento_grep, argv[1], (char *)0);

        printf("\n");
    }

    return 0;
}
